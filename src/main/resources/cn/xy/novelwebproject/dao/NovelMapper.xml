<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.xy.novelwebproject.dao.NovelMapper">
		<resultMap id="BaseResultMap" type="cn.xy.novelwebproject.bean.Novel">
				<!--
				  WARNING - @mbg.generated
				  This element is automatically generated by MyBatis Generator, do not modify.
				  This element was generated on Sat Jun 06 19:29:15 CST 2020.
				-->
				<id column="book_name" jdbcType="VARCHAR" property="book_name"/>
				<result column="book_author" jdbcType="VARCHAR" property="book_author"/>
				<result column="book_state" jdbcType="VARCHAR" property="book_state"/>
				<result column="book_words" jdbcType="INTEGER" property="book_words"/>
				<result column="book_intro" jdbcType="VARCHAR" property="book_intro"/>
				<result column="update_time" jdbcType="DATE" property="update_time"/>
				<result column="monthly_tickets" jdbcType="INTEGER" property="monthly_tickets"/>
				<result column="total_hits" jdbcType="INTEGER" property="total_hits"/>
				<result column="monthly_hits" jdbcType="INTEGER" property="monthly_hits"/>
				<result column="weekly_hits" jdbcType="INTEGER" property="weekly_hits"/>
				<result column="daily_hits" jdbcType="INTEGER" property="daily_hits"/>
				<result column="total_collections" jdbcType="INTEGER" property="total_collections"/>
				<result column="monthly_collections" jdbcType="INTEGER" property="monthly_collections"/>
				<result column="weekly_collections" jdbcType="INTEGER" property="weekly_collections"/>
				<result column="daily_collections" jdbcType="INTEGER" property="daily_collections"/>
				<result column="downloads" jdbcType="INTEGER" property="downloads"/>

		</resultMap>

		<select id="getNovelByColums" parameterType="int" resultMap="BaseResultMap">
        select * from novel limit #{0},1;
  		</select>

		<select id="getNovelByColumindex" parameterType="HashMap" resultMap="BaseResultMap">
    		select * from novel limit #{colum},#{index};
	</select>
		<select id="getWeekWecommend" resultMap="BaseResultMap">
   		 	select * from novel order by monthly_tickets desc limit 10
  		</select>
		<select id="getHistoryList" parameterType="int" resultMap="BaseResultMap">
		    SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="历史" LIMIT #{size}
		</select>
		<select id="getOnlineGameList" parameterType="int" resultMap="BaseResultMap">
    		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="网游" or novel_type.type="游戏" LIMIT #{size}
  		</select>
		<select id="getMartialArtsList" parameterType="int" resultMap="BaseResultMap">
    		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="武侠" LIMIT #{size}
  		</select>
		<select id="getCityList" parameterType="int" resultMap="BaseResultMap">
   			 SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="都市" LIMIT #{size}
  		</select>
		<select id="getImmortalKnightList" parameterType="int" resultMap="BaseResultMap">
    		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="仙侠" LIMIT #{size}
  		</select>
		<select id="getScienceFictionList" parameterType="int" resultMap="BaseResultMap">
    		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="科幻" LIMIT #{size}
  		</select>
		<select id="getFantasyList" parameterType="int" resultMap="BaseResultMap">
		    SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="玄幻" LIMIT #{size}
		</select>
		<select id="getMilitaryList" parameterType="int" resultMap="BaseResultMap">
    		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type="军事" LIMIT #{size}
  		</select>
		<select id="getAllPage" parameterType="String" resultType="int">
    		SELECT COUNT(book_name) FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type=#{type}
  		</select>
		<select id="getPageByType" resultMap="BaseResultMap">
     		SELECT * FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_name WHERE novel_type.type=#{type} LIMIT #{curpage},#{pagesize}
  		</select>
		<select id="getDownloadsList" resultMap="BaseResultMap">
    		SELECT novel.book_name FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_type WHERE novel_type.type=#{type}
    		GROUP BY novel.book_name ORDER BY novel.downloads DESC LIMIT #{pagesize}
  		</select>
		<select id="getMonthTicketList" resultMap="BaseResultMap">
    		SELECT novel.book_name FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_type WHERE novel_type.type=#{type}
    		GROUP BY novel.book_name ORDER BY novel.monthly_tickets DESC LIMIT #{pagesize}
  		</select>
		<select id="getCollectionList" resultMap="BaseResultMap">
    		SELECT novel.book_name FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_type WHERE novel_type.type=#{type}
    		GROUP BY novel.book_name ORDER BY novel.total_collections DESC LIMIT #{pagesize}
  		</select>

		<select id="getClassiFicationList" parameterType="HashMap" resultMap="BaseResultMap">
				SELECT novel.book_name,novel.book_words,novel.book_author,novel.update_time,novel.book_state FROM novel
				<if test="book_type!=''">
						INNER JOIN novel_type ON novel_type.novel_name = novel.book_type
				</if>
				<where>
						<if test="book_type!=''">
								novel_type.type=#{book_type}
						</if>
						<if test="book_state!=''">
								and novel.book_state=#{book_state}
						</if>
						<if test='wordgt!="-1"'>
								and novel.book_words >= #{wordgt}
						</if>
						<if test="wordet!='-1'">
								and novel.book_words &lt; #{wordet}
						</if>
						<if test="sort!=''">
								ORDER BY #{sort}
						</if>
						LIMIT #{curpage},10
				</where>

		</select>
		<select id="getClassiFicationPageSize" parameterType="HashMap" resultType="int">
				SELECT count(book_name) FROM novel
				<if test="book_type!=''">
						INNER JOIN novel_type ON novel_type.novel_name = novel.book_type
				</if>
				<where>
						<if test="book_type!=''">
								novel_type.type=#{book_type}
						</if>
						<if test="book_state!=''">
								and novel.book_state=#{book_state}
						</if>
						<if test='wordgt!="-1"'>
								and novel.book_words >= #{wordgt}
						</if>
						<if test="wordet!='-1'">
								and novel.book_words &lt; #{wordet}
						</if>
						<if test="sort!=''">
								ORDER BY #{sort}
						</if>
				</where>
		</select>
		<resultMap id="getNovelMsg_map" type="cn.xy.novelwebproject.bean.Novel">
				<id column="book_name" jdbcType="VARCHAR" property="book_name"/>
				<result column="book_author" jdbcType="VARCHAR" property="book_author"/>
				<result column="book_state" jdbcType="VARCHAR" property="book_state"/>
				<result column="book_words" jdbcType="INTEGER" property="book_words"/>
				<result column="book_intro" jdbcType="VARCHAR" property="book_intro"/>
				<result column="update_time" jdbcType="DATE" property="update_time"/>
				<result column="monthly_tickets" jdbcType="INTEGER" property="monthly_tickets"/>
				<result column="total_hits" jdbcType="INTEGER" property="total_hits"/>
				<result column="monthly_hits" jdbcType="INTEGER" property="monthly_hits"/>
				<result column="weekly_hits" jdbcType="INTEGER" property="weekly_hits"/>
				<result column="daily_hits" jdbcType="INTEGER" property="daily_hits"/>
				<result column="total_collections" jdbcType="INTEGER" property="total_collections"/>
				<result column="monthly_collections" jdbcType="INTEGER" property="monthly_collections"/>
				<result column="weekly_collections" jdbcType="INTEGER" property="weekly_collections"/>
				<result column="daily_collections" jdbcType="INTEGER" property="daily_collections"/>
				<result column="downloads" jdbcType="INTEGER" property="downloads"/>
				<collection property="book_type" column="noveltype" javaType="ArrayList" ofType="String">
				</collection>
		</resultMap>
		<select id="getNovelMsg" parameterType="String" resultMap="getNovelMsg_map">
    		SELECT novel_type.type noveltype,novel.book_name,novel.book_author,novel.book_state,novel.book_words,novel.book_intro,novel.update_time,
        	novel.monthly_tickets,novel.total_hits,novel.monthly_hits,novel.weekly_hits,novel.daily_hits,
        	novel.total_collections,novel.monthly_collections,novel.weekly_collections,novel.daily_collections,novel.downloads
    		FROM novel INNER JOIN novel_type ON novel_type.novel_name = novel.book_type where novel.book_name=#{book_name}
  		</select>

		<resultMap id="getBookCatalogs_map" type="cn.xy.novelwebproject.bean.Catalog">
				<id column="id" property="id"/>
				<result column="novel_name" jdbcType="VARCHAR" property="novel_name"/>
				<result column="novale_catalog" jdbcType="VARCHAR" property="novale_catalog"/>
				<result column="updatetime" jdbcType="DATE" property="updatetime"/>
		</resultMap>
		<select id="getBookCatalogs" resultMap="getBookCatalogs_map" parameterType="String">
        	SELECT id,novel_name,novale_catalog,updatetime from catalog WHERE catalog.novel_name = #{novelname} ORDER BY catalog.id ASC
  		</select>

		<select id="getNovelCatlog" parameterType="cn.xy.novelwebproject.bean.Catalog" resultType="String">
             SELECT c.content FROM catlog_content c
            where c.catlogname =#{novale_catalog}  and c.novelname=#{novel_name}
        </select>

		<select id="getVoteTicket" parameterType="String" resultType="int">
        	select n.total_collections from novel n where book_name=#{novelname}
  		</select>

		<update id="updateVoteTicket" parameterType="String">
        	UPDATE novel set total_collections =#{count} where novel.book_name=#{novelname}
  		</update>
</mapper>